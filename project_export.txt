–≠–ö–°–ü–û–†–¢ –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–û–í –ü–†–û–ï–ö–¢–ê
============================================================

[–§–ê–ô–õ 1/7]
–ü–£–¢–¨: ./Characters/character.py
----------------------------------------
# character.py
from Characters.Abilities.abilities import AbilityManager
from Config.game_config import BASE_ENERGY_COST
from .base_stats import Stats, DerivedStats

class Character:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ –∏–≥—Ä–µ."""
    def __init__(self, name, role, level=1, is_player=False, can_heal=False):
        
        self.name = name
        self.role = role
        self.is_player = is_player
        self.level = level
        self.alive = True
        self.can_heal = can_heal
        
        # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        self.stats = Stats(self)
        self.derived_stats = DerivedStats(self.stats, self.role, self.level)
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º hp –∏ —ç–Ω–µ—Ä–≥–∏—é
        self.hp = self.derived_stats.max_hp
        self.energy = self.derived_stats.max_energy
        
        # –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        self.ability_manager = AbilityManager()
        
    @staticmethod
    def scale_stats(base_stats, level, growth_rates):
        """–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è."""
        scaled_stats = {}
        for stat, base_value in base_stats.items():
            growth_rate = growth_rates.get(stat, 0.05)
            scaled_stats[stat] = int(base_value * (1 + (level - 1) * growth_rate))
        return scaled_stats
    
    # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏
    def add_ability(self, name, ability):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂—É."""
        self.ability_manager.add_ability(name, ability)
        
    def get_available_abilities(self):
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π."""
        return self.ability_manager.get_available_abilities(self)
        
    def use_ability(self, name, targets, **kwargs):
        """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏."""
        return self.ability_manager.use_ability(name, self, targets, **kwargs)
        
    def update_ability_cooldowns(self):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∫—É–ª–¥–∞—É–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞."""
        self.ability_manager.update_cooldowns()
        
    def take_heal(self, heal_amount):
        old_hp = self.hp
        self.hp = min(self.derived_stats.max_hp, self.hp + int(heal_amount))
        return self.hp - old_hp

    def take_damage(self, damage):
        """–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂—É, —É—á–∏—Ç—ã–≤–∞—è –∑–∞—â–∏—Ç—É."""
        self.hp -= damage
        if self.hp <= 0:
            self.hp = 0
            self.alive = False
        return True
        
    def is_alive(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∂–∏–≤ –ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂."""
        return self.alive
        
    def get_level(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return self.level
        
    def restore_energy(self, amount=None, percentage=None):
        """
        –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
        :param amount: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        :param percentage: –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        """
        if percentage is not None:
            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
            restore_amount = int(self.derived_stats.max_energy * (percentage / 100))
            self.energy = min(self.derived_stats.max_energy, self.energy + restore_amount)
        elif amount is not None:
            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–Ω–µ—Ä–≥–∏–∏
            self.energy = min(self.derived_stats.max_energy, self.energy + amount)
        else:
            # –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
            self.energy = self.derived_stats.max_energy
            
    def spend_energy(self, amount=BASE_ENERGY_COST):
        self.energy -= amount
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Characters/character.py
============================================================

[–§–ê–ô–õ 2/7]
–ü–£–¢–¨: ./Characters/base_mechanics.py
----------------------------------------
# mechanics.py
import random
#from config import Config

def calculate_dodge_chance(target):
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –∞—Ç–∞–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≤–∫–æ—Å—Ç–∏ —Ü–µ–ª–∏.
    :param target: –ü–µ—Ä—Å–æ–Ω–∞–∂, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—ã—Ç–∞–µ—Ç—Å—è —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –∞—Ç–∞–∫–∞.
    :return: –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–∫–ª–æ–Ω–µ–Ω–∏—è (float –æ—Ç 0.0 –¥–æ 1.0).
    """
    # –ë–∞–∑–æ–≤—ã–π —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è 5%
    base_dodge = 0.05
    # –ë–æ–Ω—É—Å –∫ —É–∫–ª–æ–Ω–µ–Ω–∏—é: +1% –∑–∞ –∫–∞–∂–¥—ã–µ 2 –µ–¥–∏–Ω–∏—Ü—ã –ª–æ–≤–∫–æ—Å—Ç–∏ —Å–≤–µ—Ä—Ö 10
    dex_bonus = max(0, (target.dexterity - 10) * 0.005) # +0.5% –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É dex > 10

    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è 30%
    return min(0.30, base_dodge + dex_bonus)

def calculate_crit_chance(character, is_heal=False):
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —à–∞–Ω—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ (—É–¥–∞—Ä–∞ –∏–ª–∏ –ª–µ—á–µ–Ω–∏—è) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≤–∫–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
    :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç.
    :param is_heal: –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ñ—Ñ–µ–∫—Ç –ª–µ—á–µ–Ω–∏–µ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é False –¥–ª—è –∞—Ç–∞–∫–∏).
    :return: –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ (float –æ—Ç 0.0 –¥–æ 1.0).
    """
    # –¢–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –Ω–∞–Ω–æ—Å–∏—Ç—å –∫—Ä–∏—Ç—ã
    if not hasattr(character, 'dexterity') or character.role == "enemy":
        return 0.0
        
    # –ë–∞–∑–æ–≤—ã–π —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 5%
    base_crit = 0.05
    # –ë–æ–Ω—É—Å –∫ –∫—Ä–∏—Ç—É: +1% –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É –ª–æ–≤–∫–æ—Å—Ç–∏ —Å–≤–µ—Ä—Ö 10
    dex_bonus = max(0, (character.dexterity - 10) * 0.01)
    
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 50%
    return min(0.50, base_crit + dex_bonus)

def perform_attack(attacker, target, battle_logger):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Ç–∞–∫—É –æ–¥–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ –¥—Ä—É–≥–æ–º—É —Å —É—á–µ—Ç–æ–º —É–∫–ª–æ–Ω–µ–Ω–∏—è –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–¥–∞—Ä–æ–≤.
    
    :param attacker: –ü–µ—Ä—Å–æ–Ω–∞–∂, –∞—Ç–∞–∫—É—é—â–∏–π.
    :param target: –ü–µ—Ä—Å–æ–Ω–∞–∂, —Ü–µ–ª—å –∞—Ç–∞–∫–∏.
    :param battle_logger: –≠–∫–∑–µ–º–ø–ª—è—Ä BattleLogger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∫–ª–æ–Ω–µ–Ω–∏—è
    dodge_chance = calculate_dodge_chance(target)
    if random.random() < dodge_chance:
        # –¶–µ–ª—å —É–∫–ª–æ–Ω—è–µ—Ç—Å—è
        #combat_stats.record_damage_dealt(attacker.name, 0) # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º 0 —É—Ä–æ–Ω–∞ –∫–∞–∫ –ø–æ–ø—ã—Ç–∫—É –∞—Ç–∞–∫–∏
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–º–æ–¥–∑–∏ –∏ —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è battle_logger
        message = f"{attacker.name} –∞—Ç–∞–∫—É–µ—Ç {target.name}, –Ω–æ {target.name} –£–ö–õ–û–ù–ò–õ–°–Ø!"
        battle_logger.log_combat_result(message)
        return # –ê—Ç–∞–∫–∞ –Ω–µ –ø–æ–ø–∞–ª–∞, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

    # --- –ê—Ç–∞–∫–∞ –ø–æ–ø–∞–ª–∞ ---
    # –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω
    base_damage = random.randint(attacker.attack // 2, attacker.attack)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞
    is_critical = False
    crit_multiplier = 1.5
    final_damage = base_damage
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞—Ç–∞–∫–∏ (is_heal=False –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    crit_chance = calculate_crit_chance(attacker)
    if random.random() < crit_chance:
        is_critical = True
        final_damage = int(base_damage * crit_multiplier)
    
    # –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω –∏ —Ä–∞—Å—Ö–æ–¥—É–µ–º —ç–Ω–µ—Ä–≥–∏—é
    #combat_stats.record_damage_dealt(attacker.name, final_damage)
    dealt, blocked = target.take_damage(final_damage)
    attacker.spend_energy() #—Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –∞—Ç–∞–∫—É
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    blocked_text = f" ({blocked} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)" if blocked > 0 else ""
    
    if is_critical:
        # –Ø—Ä–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞
        message = f"{attacker.name} –Ω–∞–Ω–æ—Å–∏—Ç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–î–ê–† –ø–æ {target.name}! –£—Ä–æ–Ω: {dealt}!{blocked_text}"
        battle_logger.log_combat_result(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫—Ä–∏—Ç. —É–¥–∞—Ä–æ–≤
    else:
        message = f"{attacker.name} –∞—Ç–∞–∫—É–µ—Ç {target.name} –∏ –Ω–∞–Ω–æ—Å–∏—Ç {dealt} —É—Ä–æ–Ω–∞!{blocked_text}"
        battle_logger.log_combat_result(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∞—Ç–∞–∫
        
    if not target.is_alive():
        #combat_stats.record_kill(attacker.name)
        #combat_stats.record_death(target.name)
        message = f"{target.name} –ø–æ–≤–µ—Ä–∂–µ–Ω!"
        battle_logger.log_death(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–º–µ—Ä—Ç–∏

# === –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–µ—á–µ–Ω–∏—è ===
def execute_heal_ability(healer, target_ally, heal_amount_base, battle_logger):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è.
    
    :param healer: –ü–µ—Ä—Å–æ–Ω–∞–∂, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π –ª–µ—á–µ–Ω–∏–µ.
    :param target_ally: –¶–µ–ª—å –ª–µ—á–µ–Ω–∏—è (—Å–æ—é–∑–Ω–∏–∫).
    :param heal_amount_base: –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–µ—á–µ–Ω–∏—è.
    :param battle_logger: –≠–∫–∑–µ–º–ø–ª—è—Ä BattleLogger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    # –°–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è –≤–æ–∫—Ä—É–≥ –±–∞–∑–æ–≤–æ–≥–æ
    base_heal_amount = random.randint(heal_amount_base - 5, heal_amount_base + 5)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è
    is_heal_critical = False
    heal_crit_multiplier = 2
    final_heal_amount = base_heal_amount
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ª–µ—á–µ–Ω–∏—è (is_heal=True)
    heal_crit_chance = calculate_crit_chance(healer, is_heal=True)
    if random.random() < heal_crit_chance:
        is_heal_critical = True
        final_heal_amount = int(base_heal_amount * heal_crit_multiplier)
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª–µ—á–µ–Ω–∏—è
    #combat_stats.record_healing_done(healer.name, final_heal_amount)
    #combat_stats.record_healing_taken(target_ally.name, final_heal_amount)
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –ª–µ—á–µ–Ω–∏–µ
    old_hp = target_ally.hp
    target_ally.hp = min(target_ally.derived_stats.max_hp, target_ally.hp + final_heal_amount)
    actual_heal = target_ally.hp - old_hp # –†–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö HP
    
    # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥
    if is_heal_critical:
        # –Ø—Ä–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è
        message = f"{healer.name} –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –õ–ï–ß–ï–ù–ò–ï –Ω–∞ {target_ally.name}! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: {actual_heal} HP!"
        battle_logger.log_heal(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫—Ä–∏—Ç. –ª–µ—á–µ–Ω–∏—è
    else:
        message = f"{healer.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –ª–µ—á–∏—Ç {target_ally.name} –Ω–∞ {actual_heal} HP"
        battle_logger.log_heal(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ª–µ—á–µ–Ω–∏—è

def execute_mass_heal_ability(healer, allies_list, heal_amount_base, battle_logger):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞—Å—Å–æ–≤–æ–µ –ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è.
    
    :param healer: –ü–µ—Ä—Å–æ–Ω–∞–∂, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π –ª–µ—á–µ–Ω–∏–µ.
    :param allies_list: –°–ø–∏—Å–æ–∫ —Å–æ—é–∑–Ω–∏–∫–æ–≤ –¥–ª—è –ª–µ—á–µ–Ω–∏—è.
    :param heal_amount_base: –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–µ—á–µ–Ω–∏—è.
    :param battle_logger: –≠–∫–∑–µ–º–ø–ª—è—Ä BattleLogger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤ –°–†–ê–ó–£
    alive_allies = [ally for ally in allies_list if ally.is_alive()]
    
    if not alive_allies:
        message = f"{healer.name} –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ –ª–µ—á–µ–Ω–∏–µ, –Ω–æ –Ω–µ—Ç –∂–∏–≤—ã—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤!"
        battle_logger.log_heal(message)
        return
    
    # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–µ—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∂–∏–≤—ã–º–∏ —Å–æ—é–∑–Ω–∏–∫–∞–º–∏
    heal_per_target = heal_amount_base // len(alive_allies)
    heal_per_target = max(1, heal_per_target)  # –ú–∏–Ω–∏–º—É–º 1
    
    # –°–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è –≤–æ–∫—Ä—É–≥ –±–∞–∑–æ–≤–æ–≥–æ –Ω–∞ —Ü–µ–ª—å
    try:
        base_heal_amount = random.randint(int(heal_per_target) - 3, int(heal_per_target) + 3)
        base_heal_amount = max(1, base_heal_amount)  # –ú–∏–Ω–∏–º—É–º 1
    except ValueError:
        # –ï—Å–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        base_heal_amount = max(1, int(heal_per_target))
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è (–æ–¥–∏–Ω —à–∞–Ω—Å –Ω–∞ –≤—Å–µ —Ü–µ–ª–∏)
    is_heal_critical = False
    heal_crit_multiplier = 1.8  # –ú–µ–Ω—å—à–µ, —á–µ–º —É –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è
    final_heal_amount = base_heal_amount
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ª–µ—á–µ–Ω–∏—è (is_heal=True)
    heal_crit_chance = calculate_crit_chance(healer, is_heal=True) * 0.7  # –ú–µ–Ω—å—à–µ —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ
    if random.random() < heal_crit_chance:
        is_heal_critical = True
        final_heal_amount = int(base_heal_amount * heal_crit_multiplier)
    
    total_healed = 0
    individual_heals = []  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞
    
    # –õ–µ—á–∏–º –∫–∞–∂–¥–æ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ
    for target_ally in alive_allies:
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª–µ—á–µ–Ω–∏—è
        #combat_stats.record_healing_done(healer.name, final_heal_amount)
        #combat_stats.record_healing_taken(target_ally.name, final_heal_amount)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ª–µ—á–µ–Ω–∏–µ
        old_hp = target_ally.hp
        target_ally.hp = min(target_ally.derived_stats.max_hp, target_ally.hp + final_heal_amount)
        actual_heal = target_ally.hp - old_hp  # –†–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö HP
        
        individual_heals.append((target_ally.name, actual_heal))
        total_healed += actual_heal
    
    # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥
    crit_text = "–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï " if is_heal_critical else ""
    crit_emoji = "‚ú®" if is_heal_critical else ""
    
    message = f"{healer.name} –ø—Ä–∏–º–µ–Ω—è–µ—Ç {crit_text}–ú–ê–°–°–û–í–û–ï –õ–ï–ß–ï–ù–ò–ï! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ {total_healed} HP —É {len(alive_allies)} —Å–æ—é–∑–Ω–∏–∫–æ–≤!"
    battle_logger.log_heal(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ª–µ—á–µ–Ω–∏—è
    
    # –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–µ—á–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    for ally_name, actual_heal in individual_heals:
        if actual_heal > 0:
            message = f"   {ally_name}: +{actual_heal} HP"
            battle_logger.log_heal(message) # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –ª–µ—á–µ–Ω–∏—è

def perform_rest(character, battle_logger):
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –æ—Ç–¥—ã—Ö–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
    –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–Ω–µ—Ä–≥–∏–∏.
    
    :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥—ã—Ö–∞–µ—Ç.
    :param battle_logger: –≠–∫–∑–µ–º–ø–ª—è—Ä BattleLogger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é
    RESTORE_ENERGY_AMOUNT = 30
    character.restore_energy(amount=RESTORE_ENERGY_AMOUNT)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    message = f"{character.name} –æ—Ç–¥—ã—Ö–∞–µ—Ç –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç {RESTORE_ENERGY_AMOUNT} —ç–Ω–µ—Ä–≥–∏–∏"
    battle_logger.log(message, character=character)

----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Characters/base_mechanics.py
============================================================

[–§–ê–ô–õ 3/7]
–ü–£–¢–¨: ./Battle/battle_logic.py
----------------------------------------

import uuid
from Battle.battle_logger import battle_logger
from Battle.battle_statistics import get_battle_statistics
from Battle.round_logic import battle_round, display_round_separator
from Battle.rewards import BattleRewards
from Config.game_config import MAX_ROUNDS
from Inventory.inventory import get_inventory

def pre_battle_setup(players, enemies) -> None:
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –±–æ—è.
    
    :param players: –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
    :param enemies: –°–ø–∏—Å–æ–∫ –≤—Ä–∞–≥–æ–≤
    """
    # TODO: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –±–æ–µ–º
    # –ù–∞–ø—Ä–∏–º–µ—Ä:
    # - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    # - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    # - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–æ—è
    # - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞—Ö
    pass

def simulate_battle(players, enemies) -> str:
    """
    –°–∏–º—É–ª–∏—Ä—É–µ—Ç –±–æ–π –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏ –∏ –≤—Ä–∞–≥–∞–º–∏.
    
    :return: –†–µ–∑—É–ª—å—Ç–∞—Ç –±–∏—Ç–≤—ã ("win", "loss", –∏–ª–∏ "draw")
    """
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–¥ –±–æ–µ–º
    pre_battle_setup(players, enemies)
    
    # –ù–∞—á–∞–ª–æ –±–æ—è
    battle_logger.log("")
    battle_logger.log("üèÅ –ë–û–ô –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø!")
    battle_result = "draw"  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–∏—á—å—è
    
    #–Ω–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    battle_id = str(uuid.uuid4())
    stats = get_battle_statistics()
    stats.start_battle_tracking(battle_id, players, enemies)

    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –±–æ—è
    for round_num in range(1, MAX_ROUNDS + 1):
        
        display_round_separator(round_num)
        round_result = battle_round(players, enemies, battle_logger)
        
        if round_result == "win" or round_result == "loss":
            battle_result = round_result
            break  # –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –±–æ–π
        
        if round_num == MAX_ROUNDS:
            battle_logger.log(f"‚è≥ –í—Ä–µ–º—è –≤—ã—à–ª–æ! –†–∞—É–Ω–¥ {round_num} —Å—Ç–∞–ª –ø–æ—Å–ª–µ–¥–Ω–∏–º.")

    # –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –±–æ—è
    # –í –∫–æ–Ω—Ü–µ –±–∏—Ç–≤—ã –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ç–æ–≥–∏
    #–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –±–æ—è
    stats.end_battle(battle_id, True, 1)

    post_battle_processing(players, enemies, battle_result)
    
    return battle_result

def post_battle_processing(players, enemies, battle_result) -> None:
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–æ—è.
    
    :param players: –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
    :param enemies: –°–ø–∏—Å–æ–∫ –≤—Ä–∞–≥–æ–≤
    :param battle_result: –†–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—è ("win", "loss", "draw")
    """
    # –ù–∞—á–∏—Å–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã –ø—Ä–∏ –ø–æ–±–µ–¥–µ
    if battle_result == "win":
        
        battle_logger.set_message_delay(0)

        battle_logger.log(f"üéñÔ∏è –ü–û–ë–ï–î–ê! –í—Å–µ –≤—Ä–∞–≥–∏ –ø–æ–≤–µ—Ä–∂–µ–Ω—ã!")
        award_rewards(players, enemies)
        # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤—Å–µ–º –≤—ã–∂–∏–≤—à–∏–º –∏–≥—Ä–æ–∫–∞–º
        restore_energy_after_battle([p for p in players if p.is_alive()])

        battle_logger.set_message_delay()
    
    # –°–±—Ä–æ—Å –∫—É–ª–¥–∞—É–Ω–æ–≤ –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π —É –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    reset_all_cooldowns(players + enemies)

def award_rewards(players, defeated_enemies) -> None:
    """
    –ù–∞—á–∏—Å–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã –∏–≥—Ä–æ–∫–∞–º –∑–∞ –ø–æ–±–µ–¥—É –≤ –±–æ—é.
    
    :param players: –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
    :param defeated_enemies: –°–ø–∏—Å–æ–∫ –ø–æ–±–µ–∂–¥–µ–Ω–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤
    """
    if not defeated_enemies:
        return
    
    # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã –º–µ–∂–¥—É –≤—ã–∂–∏–≤—à–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
    alive_players = [p for p in players if p.is_alive()]
    
    if not alive_players:
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
    reward_results = BattleRewards.distribute_rewards(defeated_enemies, alive_players)
    
    # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–∞–≥—Ä–∞–¥–∞—Ö
    for message in reward_results['messages']:
        battle_logger.log(message)

    for message in reward_results['level_up_messages']:
        battle_logger.log(message)

def restore_energy_after_battle(players) -> None:
    """
    –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 30% –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤—Å–µ–º –≤—ã–∂–∏–≤—à–∏–º –∏–≥—Ä–æ–∫–∞–º –ø–æ—Å–ª–µ –±–æ—è.
    
    :param players: –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
    """
    for player in players:
        if player.is_alive():
            player.restore_energy(percentage=30)
    
    #battle_logger.log(f"üßò –ö–æ–º–∞–Ω–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —á–∞—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ –ø–æ—Å–ª–µ –±–æ—è")

def reset_all_cooldowns(characters) -> None:
    """
    –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –∫—É–ª–¥–∞—É–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π —É –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.
    
    :param characters: –°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    """
    for character in characters:
        if hasattr(character, 'ability_manager'):
            character.ability_manager.reset_all_cooldowns()
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Battle/battle_logic.py
============================================================

[–§–ê–ô–õ 4/7]
–ü–£–¢–¨: ./Battle/round_logic.py
----------------------------------------
import random
from xxlimited import Str
from Battle.battle_logger import battle_logger
from Battle.battle_statistics import CombatActionRecord, get_battle_statistics
from Characters.behavior import decide_action

def battle_round(players, enemies, battle_logger) -> str:
    """–û–¥–∏–Ω —Ä–∞—É–Ω–¥ –±–æ—è"""
    
    battle_result = None

    # --- –•–æ–¥ –∏–≥—Ä–æ–∫–æ–≤ ---
    for player in players:
        if not player.is_alive():
            continue

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–∏–∫—É –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
        action_result = decide_action(player, players, [e for e in enemies if e.is_alive()])
        log_result(action_result)

        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞
        if all(not e.is_alive() for e in enemies):
            return "win" # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç

    # --- –•–æ–¥ –≤—Ä–∞–≥–æ–≤ ---
    for enemy in enemies:
        if not enemy.is_alive():
            continue

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–∏–∫—É –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
        action_result = decide_action(enemy, enemies, [p for p in players if p.is_alive()])
        log_result(action_result)

        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤—Ä–∞–≥–∞
        if all(not p.is_alive() for p in players):
            battle_logger.log("‚ò†Ô∏è –ü–û–†–ê–ñ–ï–ù–ò–ï! –í—Å—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ–≥–∏–±–ª–∞...")
            battle_result = "loss"
            return battle_result # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        
    # –û–±–Ω–æ–≤–ª—è–µ–º –∫—É–ª–¥–∞—É–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
    for player in players:
            player.ability_manager.update_cooldowns()
    
    for enemy in enemies:
            enemy.ability_manager.update_cooldowns()
    
    # –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –∑–∞–≤–µ—Ä—à–∞–µ–º –±–æ–π –±–µ–∑ –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    return battle_result # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç

def log_result(action_result) -> None:

    if action_result:
        #–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        stats = get_battle_statistics()
        action_record = CombatActionRecord.from_ability_result(action_result)
        stats.add_combat_action(action_record) 

        for message in action_result.messages:
            battle_logger.log(message)
    else:
        battle_logger.log_enemy_action("—á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏")

def display_round_separator(round_num):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Ä–∞—É–Ω–¥–æ–≤"""
    battle_logger.log("") # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ä–∞—É–Ω–¥–æ–º
    #separator = f"‚ó¶‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢‚ó¶‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢‚ó¶‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢(—Ä–∞—É–Ω–¥: {round_num})‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢‚ó¶‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢‚ó¶‚Ä¢‚óè‚óâ‚úø‚óâ‚óè‚Ä¢‚ó¶"
    separator = [
    ("‚ó¶", 1), ("‚Ä¢", 2), ("‚óè", 3), ("‚óâ", 4), ("‚úø", 5), ("‚óâ", 4), ("‚óè", 3), ("‚Ä¢", 2), ("‚ó¶", 1),
    ("‚Ä¢", 6), ("‚óè", 1), ("‚óâ", 2), ("‚úø", 3), ("‚óâ", 4), ("‚óè", 5), ("‚Ä¢", 6), ("‚ó¶", 1),
    ("‚Ä¢", 2), ("‚óè", 3), ("‚óâ", 4), ("‚úø", 5), ("‚óâ", 4), ("‚óè", 3), ("‚Ä¢", 2), ("‚ó¶", 1),
    (f"(—Ä–∞—É–Ω–¥: {round_num})", 8),  # –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
    ("‚Ä¢", 6), ("‚óè", 1), ("‚óâ", 2), ("‚úø", 3), ("‚óâ", 4), ("‚óè", 5), ("‚Ä¢", 6), ("‚ó¶", 1),
    ("‚Ä¢", 2), ("‚óè", 3), ("‚óâ", 4), ("‚úø", 5), ("‚óâ", 4), ("‚óè", 3), ("‚Ä¢", 2), ("‚ó¶", 1),
    ("‚Ä¢", 6), ("‚óè", 1), ("‚óâ", 2), ("‚úø", 3), ("‚óâ", 4), ("‚óè", 5), ("‚Ä¢", 6), ("‚ó¶", 1)
    ]
    
    battle_logger.log(separator)
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Battle/round_logic.py
============================================================

[–§–ê–ô–õ 5/7]
–ü–£–¢–¨: ./Characters/base_stats.py
----------------------------------------
# base_stats.py

class Stats:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–≤—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
    
    # –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –∑–∞—â–∏—Ç—ã –ø–æ —Ä–æ–ª—è–º
    DEFENSE_MULTIPLIERS = {
        "tank": 1.0,
        "warrior": 0.66,
        "healer": 0.6,
        "archer": 0.44,
        "rogue": 0.375,
        "mage": 0.285
    }
    
    # –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –∞—Ç–∞–∫–∏ –ø–æ —Ä–æ–ª—è–º
    PRIMARY_STAT_MULTIPLIERS = {
        "tank": 0.8,      # –¢–∞–Ω–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–ª—É
        "warrior": 1.0,   # –í–æ–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–ª—É
        "rogue": 1.2,     # –†–∞–∑–±–æ–π–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–æ–≤–∫–æ—Å—Ç—å
        "archer": 1.1,    # –õ—É—á–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–æ–≤–∫–æ—Å—Ç—å
        "mage": 1.3,      # –ú–∞–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
        "healer": 0.6     # –õ–µ–∫–∞—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–Ω–∏–∑–∫–∞—è –∞—Ç–∞–∫–∞)
    }
    
    def __init__(self, character):

        rates = character.BASE_STATS

        for stat_name, default_value in rates.items():
            setattr(self, stat_name, default_value)
    
    def get_primary_stat_for_role(self, role):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ä–æ–ª–∏."""
        if role in ["tank", "warrior"]:
            return self.strength
        elif role in ["rogue", "archer"]:
            return self.dexterity
        elif role in ["mage", "healer"]:
            return self.intelligence
        else:
            return self.strength
    
    def scale_stats(self, base_stats, level, growth_rates):
        """–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è."""
        scaled_stats = {}
        for stat, base_value in base_stats.items():
            growth_rate = growth_rates.get(stat, 0.05)
            scaled_stats[stat] = int(base_value * (1 + (level - 1) * growth_rate))
        return scaled_stats
    
    def update_from_scaled_stats(self, scaled_stats):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π."""
        stat_names = ['dexterity', 'constitution', 'strength', 'intelligence']
        for stat_name in stat_names:
            if stat_name in scaled_stats:
                setattr(self, stat_name, scaled_stats[stat_name])


class DerivedStats:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
    
    def __init__(self, stats, role, level):
        self.max_hp = 0
        self.max_energy = 0
        self.attack = 0
        self.defense = 0
        self.calculate_all(stats, level, role)
    
    def calculate_all(self, stats, level, role):
        """–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏."""

        dm = stats.DEFENSE_MULTIPLIERS
        psm = stats.PRIMARY_STAT_MULTIPLIERS

        self.max_hp = self.calculate_max_hp(level, stats)
        self.max_energy = self.calculate_max_energy(stats)
        self.attack = self.calculate_attack(role, stats, psm)
        self.defense = self.calculate_defense(role, stats, dm)
    
    def update_level(self, character):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏."""
        self.calculate_all(character.stats, character.level, character.role)

    def calculate_defense(self, role, stats, dm):
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏—è –∏ —Ä–æ–ª–∏."""
        base_defense = int(stats.constitution * 1.0)
        multiplier = dm.get(role, 0.5)
        return int(base_defense * multiplier)
    
    def calculate_attack(self, role, stats, psm):
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞—Ç–∞–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ä–æ–ª–∏."""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –¥–ª—è –∞—Ç–∞–∫–∏ –ø–æ —Ä–æ–ª–∏
        if role in ["rogue", "archer"]:
            primary_stat = stats.dexterity
        else:
            primary_stat = stats.strength  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            
        multiplier = 1 #psm.get(role, 0.8)
        return int(primary_stat * multiplier)
    
    def calculate_max_hp(self, level, stats):
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HP –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏—è."""
        return int(stats.constitution * 10 + level * 5)
    
    def calculate_max_energy(self, stats):
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–Ω–µ—Ä–≥–∏–∏."""
        #TODO: –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å. —É –º–∞–≥–æ–≤ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –º–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏
        return 50 + int(stats.dexterity * 7 + stats.constitution * 2)
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Characters/base_stats.py
============================================================

[–§–ê–ô–õ 6/7]
–ü–£–¢–¨: ./Battle/base_mechanics.py
----------------------------------------
import random
from Battle.battle_logger import battle_logger

class GameMechanics:
    """–ë–∞–∑–æ–≤—ã–µ –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏."""
    
    @staticmethod
    def calculate_dodge_chance(target):
        """
        –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –∞—Ç–∞–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≤–∫–æ—Å—Ç–∏ —Ü–µ–ª–∏.
        :param target: –ü–µ—Ä—Å–æ–Ω–∞–∂, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—ã—Ç–∞–µ—Ç—Å—è —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –∞—Ç–∞–∫–∞.
        :return: –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–∫–ª–æ–Ω–µ–Ω–∏—è (float –æ—Ç 0.0 –¥–æ 1.0).
        """
        # –ë–∞–∑–æ–≤—ã–π —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è 5%
        base_dodge = 0.05
        # –ë–æ–Ω—É—Å –∫ —É–∫–ª–æ–Ω–µ–Ω–∏—é: +1% –∑–∞ –∫–∞–∂–¥—ã–µ 2 –µ–¥–∏–Ω–∏—Ü—ã –ª–æ–≤–∫–æ—Å—Ç–∏ —Å–≤–µ—Ä—Ö 10
        dex_bonus = max(0, (target.stats.dexterity - 10) * 0.005) # +0.5% –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É dex > 10
        
        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è 30%
        return min(0.30, base_dodge + dex_bonus)
    
    @staticmethod
    def calculate_crit_chance(character):
        """
        –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —à–∞–Ω—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ (—É–¥–∞—Ä–∞ –∏–ª–∏ –ª–µ—á–µ–Ω–∏—è) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≤–∫–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç.
        :return: –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ (float –æ—Ç 0.0 –¥–æ 1.0).
        """
        # –ë–∞–∑–æ–≤—ã–π —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 5%
        base_crit = 0.05
        # –ë–æ–Ω—É—Å –∫ –∫—Ä–∏—Ç—É: +1% –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É –ª–æ–≤–∫–æ—Å—Ç–∏ —Å–≤–µ—Ä—Ö 10
        crit_bonus = max(0, (character.stats.dexterity - 10) * 0.01)
        
        #TODO: –ø–æ–∫–∞ –¥–µ–ª–∞–µ–º –∫—Ä–∏—Ç –∫–∞–∫ —Ä–µ—à–µ–Ω–∏–µ –≤ –ª–æ–± - –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å
        a = 0
        crit_ability = character.ability_manager.get_passive_ability('criticalstrike')
        if crit_ability:
            ability_effect = crit_ability.apply_effect(character)
            crit_bonus += ability_effect['critical_bonus']
        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ 50%
        return min(0.50, base_crit + crit_bonus)
    
    @staticmethod
    def calculate_damage_variance(base_damage, variance_percent=0.1):
        """
        –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —É—Ä–æ–Ω–∞.
        :param base_damage: –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω
        :param variance_percent: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10%)
        :return: –§–∏–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω —Å —É—á–µ—Ç–æ–º –≤–∞—Ä–∏–∞—Ü–∏–∏
        """
        min_damage = base_damage * (1 - variance_percent)
        max_damage = base_damage * (1 + variance_percent)
        return random.uniform(min_damage, max_damage)
    
    @staticmethod
    def calculate_armor_reduction(damage, armor):
        """
        –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –±—Ä–æ–Ω–µ–π —Å –ø–ª–∞–≤–Ω–æ–π S-–æ–±—Ä–∞–∑–Ω–æ–π –∫—Ä–∏–≤–æ–π.
        :param damage: –ò—Å—Ö–æ–¥–Ω—ã–π —É—Ä–æ–Ω
        :param armor: –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –±—Ä–æ–Ω–∏
        :return: –£—Ä–æ–Ω –ø–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è –±—Ä–æ–Ω–µ–π
        """
        if armor <= 0:
            return damage
        
        # S-–æ–±—Ä–∞–∑–Ω–∞—è –∫—Ä–∏–≤–∞—è (—Å–∏–≥–º–æ–∏–¥) –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        # k - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫—Ä—É—Ç–∏–∑–Ω—ã –∫—Ä–∏–≤–æ–π (–º–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–∞—è –∫—Ä–∏–≤–∞—è)
        k = 0.03
        armor_effectiveness = 1 / (1 + 2.718 ** (-k * (armor - 50)))  # –°–∏–≥–º–æ–∏–¥ —Å —Ü–µ–Ω—Ç—Ä–æ–º –≤ 50
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–º–∞–∫—Å–∏–º—É–º 85% –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
        armor_effectiveness = min(armor_effectiveness, 0.85)
        reduced_damage = damage * (1 - armor_effectiveness)
        # –£—Ä–æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1
        return max(1, int(reduced_damage)), int(damage - reduced_damage)
    
    @staticmethod
    def check_dodge_with_message(attacker, target):
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —É–¥–∞–ª–æ—Å—å –ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂—É —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.
        :param attacker: –ê—Ç–∞–∫—É—é—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂
        :param target: –¶–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –ø—ã—Ç–∞–µ—Ç—Å—è —É–∫–ª–æ–Ω–∏—Ç—å—Å—è
        :return: –ö–æ—Ä—Ç–µ–∂ (—É—Å–ø–µ—à–Ω–æ_—É–∫–ª–æ–Ω–∏–ª—Å—è: bool, —Å–æ–æ–±—â–µ–Ω–∏–µ: list)
        """
        dodge_chance = GameMechanics.calculate_dodge_chance(target)
        dodge_success = random.random() < dodge_chance
        
        if dodge_success:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É–∫–ª–æ–Ω–µ–Ω–∏–∏
            icon = "üèÉ"

            template = "%1 %2 –∞—Ç–∞–∫—É–µ—Ç %3, –Ω–æ —Ç–æ—Ç —É–∫–ª–æ–Ω—è–µ—Ç—Å—è!"
            if attacker.is_player:
                elements = [(icon, 0), (attacker.name, 2), (target.name, 4)]
            else:
                elements = [(icon, 0), (attacker.name, 4), (target.name, 2)]
            message = battle_logger.create_log_message(template, elements)
        else:
            message = None
            
        return dodge_success, message
    
    @staticmethod
    def check_critical(character):
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ —ç—Ñ—Ñ–µ–∫—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º.
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç
        :return: True –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç, False –µ—Å–ª–∏ –Ω–µ—Ç
        """
        crit_chance = GameMechanics.calculate_crit_chance(character)
        return random.random() < crit_chance
    
    @staticmethod
    def apply_all_mechanics(ability, attacker, target, base_damage):
        """
        –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.
        :param attacker: –ê—Ç–∞–∫—É—é—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂
        :param target: –¶–µ–ª—å –∞—Ç–∞–∫–∏
        :param base_damage: –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω
        :return: –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —É—Ä–æ–Ω–æ–º
        """
        results = {
            'dodge_success': False,
            'dodge_message': None,
            'critical_hit': False,
            'base_damage': base_damage,
            'varied_damage': 0,
            'blocked_damage': 0,
            'reduced_damage': 0,
            'final_damage': 0
        }
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞
        results['critical_hit'] = GameMechanics.check_critical(attacker)
        crit_multiplier = 2.0 if results['critical_hit'] else 1.0
        
        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —É—Ä–æ–Ω–∞/—Ö–∏–ª–∞
        results['varied_damage'] = GameMechanics.calculate_damage_variance(base_damage)
        damage_after_variance = results['varied_damage'] * crit_multiplier
        results['final_damage'] = int(damage_after_variance)
        
        if ability.type == 0: #(–ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∞—Ç–∞–∫–∏)
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∫–ª–æ–Ω–µ–Ω–∏—è —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏—è
            dodge_success, dodge_message = GameMechanics.check_dodge_with_message(attacker, target)
            results['dodge_success'] = dodge_success
            results['dodge_message'] = dodge_message
            
            if dodge_success:
                results['final_damage'] = 0
                return results
        
            # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏
            defence = target.derived_stats.defense
            if defence > 0:
                results['reduced_damage'], results['blocked_damage'] = GameMechanics.calculate_armor_reduction(
                    damage_after_variance, defence)
            else:
                results['reduced_damage'] = damage_after_variance
            
            results['final_damage'] = max(0, round(results['reduced_damage']))
        
        return results
    
    @staticmethod
    def get_mechanics_summary():
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫.
        :return: –°–ª–æ–≤–∞—Ä—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ö–∞–Ω–∏–∫
        """
        return {
            'dodge': '–†–∞—Å—á–µ—Ç —à–∞–Ω—Å–∞ —É–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –∞—Ç–∞–∫–∏',
            'crit': '–†–∞—Å—á–µ—Ç —à–∞–Ω—Å–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞',
            'variance': '–°–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —É—Ä–æ–Ω–∞',
            'armor': '–°–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –±—Ä–æ–Ω–µ–π',
            'all': '–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ö–∞–Ω–∏–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ'
        }
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Battle/base_mechanics.py
============================================================

[–§–ê–ô–õ 7/7]
–ü–£–¢–¨: ./Characters/Abilities/abilities.py
----------------------------------------
# Characters/Abilities/ability_base.py - –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π

import os
import re
import importlib.util
from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional, Union
from Config.game_config import ABILITIES_PATH


class AbilityResult:
    """–ü—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π."""
    
    def __init__(self) -> None:
        # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
        self.success: bool = True
        self.ability_type: str = ""
        self.character: str = ""
        self.targets: List[str] = []
        self.messages: List[Any] = []
        self.damage_dealt: int = 0
        self.heal_amount: int = 0
        self.energy_restored: int = 0
        self.is_critical: bool = False
        self.total_damage: int = 0
        self.total_heal: int = 0
        self.reason: str = ""  # –ü—Ä–∏—á–∏–Ω–∞ –Ω–µ—É–¥–∞—á–∏
        self.details: Dict[str, Any] = {}  # –î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

class Ability(ABC):
    """–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é"""
    
    def __init__(self, name: str, type: int = 0, description: str = "", icon: str = "") -> None:
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        
        :param name: –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param type: –¢–∏–ø —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ - 0 - –∞—Ç–∞–∫–∞, 1 - –ª–µ—á–µ–Ω–∏–µ, 2 - –æ—Ç–¥—ã—Ö –∏ —Ç.–¥.
        :param description: –û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param icon: –ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        """
        self.name: str = name
        self.type: int = type
        self.level: int = 0  # –£—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (0 = –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
        self.description: str = description
        self.icon: str = icon
    
    def level_up(self) -> int:
        """–ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ 1"""
        self.level += 1
        return self.level
    
    def set_level(self, level: int) -> int:
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"""
        self.level = max(0, level)  # –£—Ä–æ–≤–µ–Ω—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 0
        return self.level
    
    def is_available(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (—É—Ä–æ–≤–µ–Ω—å > 0)"""
        return self.level > 0
    
    def get_info(self) -> Dict[str, Any]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏."""
        return {
            'name': self.name,
            'type': self.type,
            'description': self.description,
            'level': self.level
        }
    
    @abstractmethod
    def can_use(self, character: Any, targets: Optional[List[Any]] = None) -> bool:
        """–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"""
        pass
    
    @abstractmethod
    def use(self, character: Any, targets: List[Any], **kwargs: Any) -> AbilityResult:
        """–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"""
        pass

class ActiveAbility(Ability):
    """–ê–∫—Ç–∏–≤–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∏–≥—Ä–æ–∫–æ–º"""
    
    def __init__(self, name: str, type: int = 0, damage_scale: float = 0.0, cooldown: int = 1, 
                 energy_cost: int = 0, description: str = "", icon: str = "", is_mass: bool = False) -> None:
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        
        :param name: –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param type: –¢–∏–ø —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ - 0 - –∞—Ç–∞–∫–∞, 1 - –ª–µ—á–µ–Ω–∏–µ, 2 - –æ—Ç–¥—ã—Ö –∏ —Ç.–¥.
        :param damage_scale: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Ä–æ–Ω–∞ –æ—Ç –∞—Ç–∞–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞
        :param cooldown: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param energy_cost: –°—Ç–æ–∏–º–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        :param description: –û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param icon: –ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param is_mass: –ú–∞—Å—Å–æ–≤–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        """
        super().__init__(name, type, description, icon)
        self.damage_scale: float = damage_scale
        self.energy_cost: int = energy_cost
        self.is_mass: bool = is_mass
        self.cooldown: int = cooldown
        self.current_cooldown: int = 0
    
    def can_use(self, character: Any, targets: Optional[List[Any]] = None) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.
        
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        :param targets: –¶–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        :return: True, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∏–Ω–∞—á–µ False
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        if self.level <= 0:
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω
        if self.current_cooldown > 0:
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–µ—Ä–≥–∏—é
        if hasattr(character, 'energy') and character.energy < self.energy_cost:
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        return self.check_specific_conditions(character, targets or [])
    
    def check_specific_conditions(self, character: Any, targets: List[Any]) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö.
        """
        return True
    
    def use(self, character: Any, targets: List[Any], **kwargs: Any) -> AbilityResult:
        """
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.
        
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        :param targets: –°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π
        :param kwargs: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        :return: –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        """
        if not self.can_use(character, targets):
            result = AbilityResult()
            result.success = False
            result.reason = "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å"
            result.ability_type = self.__class__.__name__.lower()
            result.character = character.name if hasattr(character, 'name') else str(character)
            return result
        
        # –¢—Ä–∞—Ç–∏–º —ç–Ω–µ—Ä–≥–∏—é
        if hasattr(character, 'energy'):
            character.energy -= self.energy_cost
            
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∫—É–ª–¥–∞—É–Ω
        self.current_cooldown = self.cooldown
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        result = self.execute(character, targets, **kwargs)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        self.on_use(character, targets, result)
        
        return result
    
    def execute(self, character: Any, targets: List[Any], **kwargs: Any) -> AbilityResult:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö.
        """
        raise NotImplementedError("–ú–µ—Ç–æ–¥ execute –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–æ–¥–∫–ª–∞—Å—Å–µ")
    
    def update_cooldown(self) -> None:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∫—É–ª–¥–∞—É–Ω —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞."""
        if self.current_cooldown > 0:
            self.current_cooldown -= 1
    
    def on_use(self, character: Any, targets: List[Any], result: AbilityResult) -> None:
        """
        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ç.–¥.
        """
        pass
    
    def get_info(self) -> Dict[str, Any]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏."""
        info = super().get_info()
        info.update({
            'damage_scale': self.damage_scale,
            'energy_cost': self.energy_cost,
            'is_mass': self.is_mass,
            'cooldown': self.cooldown,
            'current_cooldown': self.current_cooldown
        })
        return info

class PassiveAbility(Ability):
    """–ü–∞—Å—Å–∏–≤–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏"""
    
    def __init__(self, name: str, type: int = 0, description: str = "", icon: str = "") -> None:
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Å—Å–∏–≤–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        
        :param name: –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param type: –¢–∏–ø —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param description: –û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param icon: –ò–∫–æ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        """
        super().__init__(name, type, description, icon)
    
    def can_use(self, character: Any, targets: Optional[List[Any]] = None) -> bool:
        """
        –ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –µ—Å–ª–∏ –∏–º–µ—é—Ç —É—Ä–æ–≤–µ–Ω—å > 0.
        –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π.
        """
        return self.is_available()
    
    def use(self, character: Any, targets: List[Any], **kwargs: Any) -> AbilityResult:
        """
        –ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –Ω–∞–ø—Ä—è–º—É—é.
        """
        result = AbilityResult()
        result.success = False
        result.reason = "–ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é"
        result.ability_type = self.__class__.__name__.lower()
        result.character = character.name if hasattr(character, 'name') else str(character)
        return result
    
    def apply_effect(self, character: Any, **kwargs: Any) -> Any:
        """
        –ü—Ä–∏–º–µ–Ω—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –ø–∞—Å—Å–∏–≤–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö.
        """
        raise NotImplementedError("–ú–µ—Ç–æ–¥ apply_effect –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–æ–¥–∫–ª–∞—Å—Å–µ")

# === Singleton AbilityLoader ===

class AbilityLoader:
    _instance: Optional['AbilityLoader'] = None
    _initialized: bool = False
    
    def __new__(cls, root_folder: Optional[str] = None) -> 'AbilityLoader':
        if cls._instance is None:
            cls._instance = super(AbilityLoader, cls).__new__(cls)
        return cls._instance
    
    def __init__(self, root_folder: Optional[str] = None) -> None:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
        if not self._initialized:
            self.root_folder: str = root_folder or 'Characters/Abilities'
            self._class_map: Dict[str, type] = {}  # –¢–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏–º –∫–ª–∞—Å—Å—ã, –∞ –Ω–µ –ø—É—Ç–∏
            self._scan_abilities()
            self.__class__._initialized = True
    
    def _scan_abilities(self) -> None:
        """–°–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–ª–∞—Å—Å—ã —ç—Ç–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π"""
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏
        base_path = os.path.normpath(ABILITIES_PATH)
        
        if not os.path.exists(base_path):
            raise FileNotFoundError(f"Root folder '{base_path}' not found")
        
        for dirpath, dirnames, filenames in os.walk(base_path):
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–≥–¥–µ –ª–µ–∂–∏—Ç abilities.py)
            if dirpath == base_path:
                continue

            for filename in filenames:
                # –ò—Å–∫–ª—é—á–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã
                if (filename.endswith('.py') and 
                    filename not in ['__init__.py', 'ability_base.py', 'abilities.py']):
                    full_path = os.path.join(dirpath, filename)
                    
                    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∞—Å—Å —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
                    try:
                        class_name = self._get_class_name_from_file(full_path)
                        if class_name:
                            ability_class = self._load_class_from_file(full_path, class_name)
                            self._class_map[class_name] = ability_class
                    except Exception as e:
                        print(f"Warning: Failed to load ability class from '{full_path}': {str(e)}")
    
    def _get_class_name_from_file(self, file_path: str) -> Optional[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–º—è –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏–∑ —Ñ–∞–π–ª–∞ Python"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # –ò—â–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–ª–∞—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ class –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏)
            match = re.search(r'^class\s+(\w+)', content, re.MULTILINE)
            if match:
                return match.group(1)
            return None
        except Exception:
            return None

    def _load_class_from_file(self, file_path: str, class_name: str) -> type:

        spec = importlib.util.spec_from_file_location(class_name, file_path)
        module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(module)
        
        if not hasattr(module, class_name):
            raise AttributeError(f"Class '{class_name}' not found in module '{file_path}'")
            
        return getattr(module, class_name)
    
    def get_class(self, class_name: str) -> type:
        """–ü–æ–ª—É—á–∞–µ—Ç –∫–ª–∞—Å—Å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ –∏–º–µ–Ω–∏"""
        if class_name not in self._class_map:
            available_abilities = list(self._class_map.keys())
            raise FileNotFoundError(f"Ability class '{class_name}' not found. Available abilities: {available_abilities}")
        
        return self._class_map[class_name]
    
    def get_available_abilities(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–º–µ–Ω —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π"""
        return list(self._class_map.keys())
    
    @classmethod
    def get_instance(cls) -> 'AbilityLoader':
        """–ü–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä singleton"""
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance

# === –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===

class AbilityManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞"""
    
    def __init__(self) -> None:
        # –†–∞–∑–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –ø–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        self.active_abilities: Dict[str, ActiveAbility] = {}  # {name: ActiveAbility instance}
        self.passive_abilities: Dict[str, PassiveAbility] = {}  # {name: PassiveAbility instance}
        # –ü–æ–ª—É—á–∞–µ–º singleton instance AbilityLoader
        self.ability_loader: AbilityLoader = AbilityLoader.get_instance()
        # –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        self.add_ability_by_name('Attack')
        self.add_ability_by_name('Rest')
    
    def add_ability(self, name: str, ability_instance: Union[ActiveAbility, PassiveAbility]) -> bool:
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂—É."""
        try:
            # –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            if hasattr(ability_instance, '__class__'):
                new_ability = ability_instance.__class__()
                # –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã
                for attr, value in ability_instance.__dict__.items():
                    setattr(new_ability, attr, value)
            else:
                new_ability = ability_instance
                
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å
            if isinstance(new_ability, PassiveAbility):
                self.passive_abilities[name] = new_ability
            elif isinstance(new_ability, ActiveAbility):
                self.active_abilities[name] = new_ability
            return True
        except Exception as e:
            print(f"Error adding ability '{name}': {e}")
            return False
    
    def remove_ability(self, name: str) -> bool:
        """–£–¥–∞–ª—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏."""
        if name in self.active_abilities:
            del self.active_abilities[name]
            return True
        elif name in self.passive_abilities:
            del self.passive_abilities[name]
            return True
        return False
    
    def clear_abilities(self) -> None:
        """–£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏."""
        self.active_abilities.clear()
        self.passive_abilities.clear()
    
    def get_ability(self, name: str) -> Optional[Union[ActiveAbility, PassiveAbility]]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏."""
        if name in self.active_abilities:
            return self.active_abilities[name]
        elif name in self.passive_abilities:
            return self.passive_abilities[name]
        return None
    
    def get_active_ability(self, name: str) -> Optional[ActiveAbility]:
        """–ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏."""
        return self.active_abilities.get(name)
    
    def get_passive_ability(self, name: str) -> Optional[PassiveAbility]:
        """–ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏."""
        return self.passive_abilities.get(name)
    
    def get_all_abilities(self) -> List[Union[ActiveAbility, PassiveAbility]]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.active_abilities.values()) + list(self.passive_abilities.values())
    
    def get_active_abilities(self) -> List[ActiveAbility]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.active_abilities.values())
    
    def get_passive_abilities(self) -> List[PassiveAbility]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.passive_abilities.values())
    
    def get_all_ability_names(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º–µ–Ω–∞ –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.active_abilities.keys()) + list(self.passive_abilities.keys())
    
    def get_active_ability_names(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.active_abilities.keys())
    
    def get_passive_ability_names(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –ø–∞—Å—Å–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."""
        return list(self.passive_abilities.keys())
    
    def get_available_abilities(self, character: Any) -> List[ActiveAbility]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω—ã.
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π
        :return: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π (ActiveAbility instances)
        """
        return [ability for ability in self.active_abilities.values() if ability.can_use(character)]
    
    def get_available_ability_names(self, character: Any) -> List[str]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω—ã.
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π
        :return: –°–ø–∏—Å–æ–∫ –∏–º–µ–Ω –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
        """
        return [name for name, ability in self.active_abilities.items() if ability.can_use(character)]
    
    def get_available_passive_abilities(self, character: Any) -> List[PassiveAbility]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω—ã.
        :param character: –ü–µ—Ä—Å–æ–Ω–∞–∂ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π
        :return: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞—Å—Å–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π (PassiveAbility instances)
        """
        return [ability for ability in self.passive_abilities.values() if ability.is_available()]
    
    def use_ability(self, ability: Optional[ActiveAbility], character: Any, 
                   targets: List[Any], **kwargs: Any) -> AbilityResult:
        """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä—è–º—É—é."""
        if ability and isinstance(ability, ActiveAbility) and ability.can_use(character, targets):
            return ability.use(character, targets, **kwargs)
        result = AbilityResult()
        result.success = False
        result.reason = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π"
        return result
    
    def update_cooldowns(self) -> None:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∫—É–ª–¥–∞—É–Ω—ã –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞."""
        for ability in self.active_abilities.values():
            if hasattr(ability, 'update_cooldown'):
                ability.update_cooldown()

    def reset_all_cooldowns(self) -> None:
        """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –∫—É–ª–¥–∞—É–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –¥–æ 0."""
        for ability in self.active_abilities.values():
            if hasattr(ability, 'current_cooldown'):
                ability.current_cooldown = 0
    
    def create_ability_by_name(self, ability_name: str) -> Optional[Union[ActiveAbility, PassiveAbility]]:
        """
        –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ AbilityLoader.
        
        :param ability_name: –ò–º—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–µ–º –∫–ª–∞—Å—Å–∞)
        :return: –≠–∫–∑–µ–º–ø–ª—è—Ä —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        """
        try:
            ability_class = self.ability_loader.get_class(ability_name)
            return ability_class()
        except (FileNotFoundError, ImportError, AttributeError) as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ '{ability_name}': {e}")
            return None
    
    def add_ability_by_name(self, ability_name: str) -> bool:
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏.
        
        :param ability_name: –ò–º—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        :return: True, –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        ability_instance = self.create_ability_by_name(ability_name)
        if ability_instance:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ (–≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ) –∫–∞–∫ –∫–ª—é—á
            name_key = ability_name.lower()
            return self.add_ability(name_key, ability_instance)
        return False
    
    def level_up_ability(self, ability_name: str) -> int:
        """
        –ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ 1.
        
        :param ability_name: –ò–º—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :return: –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–ª–∏ -1 –µ—Å–ª–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        """
        ability = self.get_ability(ability_name)
        if ability:
            return ability.level_up()
        return -1
    
    def set_ability_level(self, ability_name: str, level: int) -> int:
        """
        –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
        
        :param ability_name: –ò–º—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        :param level: –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
        :return: –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–ª–∏ -1 –µ—Å–ª–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        """
        ability = self.get_ability(ability_name)
        if ability:
            return ability.set_level(level)
        return -1

# –£–¥–æ–±–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è AbilityLoader
def get_ability_loader() -> AbilityLoader:
    """–ü–æ–ª—É—á–∏—Ç—å singleton —ç–∫–∑–µ–º–ø–ª—è—Ä AbilityLoader"""
    return AbilityLoader.get_instance()
----------------------------------------
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê: ./Characters/Abilities/abilities.py
============================================================

